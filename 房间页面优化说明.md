# 房间页面优化说明

## 优化日期
2026年1月16日

## 问题描述

用户反馈了以下5个需要优化的问题：

1. 两个模式的页面中间都有黑块，需要去除
2. 房间中每个成员占用屏幕空间太大，需要缩小为小正方形样式
3. 需添加逻辑不可向自己转账
4. 点击转账弹窗下方过于拥挤，看不见输入框内容
5. 每次转账等操作后tip提示停留时长过久

## 优化内容

### 1. 去除黑块问题 ✅

**问题原因：**
- Canvas元素未设置边框，在某些设备上显示为黑色
- 输入框等元素背景色不统一

**解决方案：**
- 为所有Canvas元素添加白色背景和淡灰色边框
  - `result-canvas`: 添加 `border: 1rpx solid #f5f5f5`
  - `qrcode-canvas`: 添加 `border: 1rpx solid #f5f5f5`
- 统一输入框背景色为纯白色 `#ffffff`
- 统一信息卡片背景色为浅灰 `#f8f8f8`
- 为弹窗添加 `overflow: hidden` 确保内容不溢出

**修改文件：** `miniprogram/pages/room/room.wxss`

---

### 2. 成员列表改为小正方形网格布局 ✅

**问题原因：**
- 成员列表使用横向卡片布局（`flex-direction: column`）
- 每个成员占据整行空间
- 信息展示过多（头像+昵称+积分+标签）

**解决方案：**
- 改为网格布局（`flex-wrap: wrap` + `width: calc(33.333% - 16rpx)`）
- 每行显示3个成员
- 成员卡片改为小正方形：
  - 头像：100rpx × 100rpx（圆形）
  - 布局：垂直排列（头像在上，昵称和积分在下）
  - 最小高度：180rpx
- 房主标签改为绝对定位（右上角）
- 昵称和积分居中对齐

**修改文件：** `miniprogram/pages/room/room.wxss`

**修改前样式：**
```css
.members-list {
  display: flex;
  flex-direction: column;  /* 垂直排列 */
  gap: 16rpx;
}

.member-item {
  display: flex;
  align-items: center;  /* 水平排列 */
  padding: 20rpx;
  width: 100%;  /* 占据整行 */
}
```

**修改后样式：**
```css
.members-list {
  display: flex;
  flex-wrap: wrap;  /* 网格布局 */
  gap: 24rpx;
  justify-content: flex-start;
}

.member-item {
  display: flex;
  flex-direction: column;  /* 垂直排列 */
  align-items: center;
  padding: 20rpx 16rpx;
  width: calc(33.333% - 16rpx);  /* 每行3个 */
  min-height: 180rpx;
  position: relative;  /* 支持标签绝对定位 */
}

.creator-tag {
  position: absolute;  /* 绝对定位 */
  top: 12rpx;
  right: 12rpx;
}
```

---

### 3. 添加不可向自己转账逻辑 ✅

**问题原因：**
- 未检查转账目标是否为自己
- 用户可能误操作导致向自己转账

**解决方案：**
- 在 `handleMemberTap` 函数中添加判断
- 普通模式：检查 `member.name === this.data.currentUser`
- 点击自己时显示提示：「不能向自己转账」

**修改文件：** `miniprogram/pages/room/room.js`

**修改代码：**
```javascript
handleMemberTap(e) {
  const index = e.currentTarget.dataset.index;
  const member = this.data.room.members[index];

  // 游戏已结束，不允许操作
  if (this.data.room.status !== 'playing') {
    this.showTip('游戏已结束，无法操作');
    return;
  }

  // 普通模式：检查是否点击自己
  if (this.data.room.gameMode === 'normal') {
    if (member.name === this.data.currentUser) {
      this.showTip('不能向自己转账');  // 新增提示
      return;
    }

    // 普通模式：点击玩家头像弹出转账弹窗
    this.setData({
      targetMemberIndex: index,
      targetMember: member.name,
      showTransferModal: true,
      transferAmount: '',
      showInputError: false
    });
  } else {
    // 下注模式：提示仅支持向奖池转入
    this.showTip('本模式仅支持向奖池转入积分');
  }
}
```

---

### 4. 转账弹窗向上挪动，增加底部留白 ✅

**问题原因：**
- 弹窗底部padding只有50rpx
- 输入框下方按钮距离过近
- 弹窗内容被遮挡

**解决方案：**
- 增加弹窗底部padding：从50rpx改为100rpx
- 为转账信息添加浅灰背景和圆角
- 减少信息行padding，节省空间
- 为输入框添加focus状态样式
- 为弹窗添加overflow: hidden防止内容溢出

**修改文件：** `miniprogram/pages/room/room.wxss`

**修改代码：**
```css
.modal-body {
  padding: 36rpx 40rpx 100rpx;  /* 底部从50rpx改为100rpx */
}

.transfer-info {
  margin-bottom: 32rpx;
  padding: 20rpx;  /* 新增padding和背景 */
  background-color: #f8f8f8;  /* 浅灰背景 */
  border-radius: 16rpx;  /* 圆角 */
}

.info-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12rpx 0;  /* 从16rpx改为12rpx */
  font-size: 28rpx;
}

.score-input {
  width: 100%;
  padding: 24rpx 28rpx;
  background-color: #ffffff;  /* 确保白色背景 */
  border: 2rpx solid #e8e8e8;
  border-radius: 20rpx;
  font-size: 28rpx;
  color: #1a1a1a;
  transition: all 0.25s;
}

.score-input:focus {
  border-color: #07C160;  /* 新增focus样式 */
  background-color: #ffffff;
}

.score-input::placeholder {
  color: #c5c5c5;  /* 新增placeholder颜色 */
}
```

---

### 5. 缩短tip提示停留时长 ✅

**问题原因：**
- 提示时长设置为2000ms（2秒）
- 用户反馈时间过长

**解决方案：**
- 将提示时长从2000ms改为1500ms（1.5秒）
- 为tip弹窗添加最大宽度限制
- 优化文本居中显示

**修改文件：** `miniprogram/pages/room/room.js`

**修改代码：**
```javascript
showTip(text) {
  this.setData({ tipText: text, showTipModal: true });
  setTimeout(() => {
    this.setData({ showTipModal: false });
  }, 1500);  // 从2000改为1500
}
```

**同时优化弹窗样式：**
```css
.tip-modal {
  max-width: 80%;  /* 新增最大宽度限制 */
}

.tip-text {
  text-align: center;  /* 新增文本居中 */
}
```

---

## 其他优化

### 弹窗overflow优化
- 为所有弹窗添加 `overflow: hidden`
- 为可滚动弹窗添加 `overflow-y: auto` 和 `max-height`
  - 结果弹窗：`max-height: 85vh`
  - 二维码弹窗：`max-height: 90vh`

### 输入框样式统一
- 所有输入框背景色统一为白色
- 添加focus状态样式
- 统一placeholder颜色

### Canvas元素优化
- 为Canvas添加白色背景
- 添加淡灰色边框防止黑块

---

## 修改文件清单

### 样式文件
- `miniprogram/pages/room/room.wxss`
  - 成员列表布局改为网格
  - 弹窗padding调整
  - 输入框样式优化
  - Canvas边框添加
  - 弹窗overflow处理

### 逻辑文件
- `miniprogram/pages/room/room.js`
  - 添加不可向自己转账判断
  - tip提示时长缩短

---

## 测试建议

### 1. 成员列表测试
- 创建普通模式房间
- 添加多个成员（3-6人）
- 验证：每行显示3个成员
- 验证：小正方形样式正常显示
- 验证：房主标签在右上角

### 2. 转账功能测试
- 点击其他成员→弹出转账弹窗
- 验证：输入框可见，不被遮挡
- 验证：底部有足够留白
- 输入积分→确认转账
- 验证：积分正确更新
- 验证：转账记录生成

### 3. 不可向自己转账测试
- 点击自己头像
- 验证：提示「不能向自己转账」
- 验证：转账弹窗不弹出

### 4. 黑块问题测试
- 打开普通模式房间
- 打开下注模式房间
- 验证：页面中间无黑块
- 打开战绩弹窗
- 验证：Canvas显示正常（白色背景）
- 打开二维码弹窗
- 验证：Canvas显示正常（白色背景）

### 5. 提示时长测试
- 执行转账操作
- 验证：提示显示1.5秒后自动消失
- 执行收取奖池操作
- 验证：提示显示1.5秒后自动消失
- 非房主点击结算
- 验证：提示显示1.5秒后自动消失

---

## 已知问题

无已知问题。

---

## 后续建议

1. **体验优化**
   - 添加更多微交互动画
   - 优化输入框键盘弹起时的页面滚动
   - 添加手势操作（长按、滑动）

2. **功能增强**
   - 添加转账历史搜索
   - 支持批量操作
   - 添加积分变化动画

3. **性能优化**
   - 优化大量成员时的渲染性能
   - 添加虚拟滚动
   - 优化Canvas绘制性能

---

**优化状态：** ✅ 已完成
**最后更新：** 2026年1月16日
