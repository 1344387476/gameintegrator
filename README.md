# 打牌记账小程序

一个用于记录打牌积分、结算战绩的微信小程序，支持普通模式和下注模式。

## 功能特性

### 核心功能
- **用户管理**：支持微信头像选择和昵称设置
- **房间管理**：创建房间、扫码加入房间
- **双模式支持**：
  - **普通模式**：支持玩家之间转账积分
  - **下注模式**：支持公共奖池机制，玩家可转入和收取奖池
- **批量支出**：支持同时向多个玩家转账
- **游戏结算**：房主可以结算游戏，生成战绩并重置积分
- **战绩分享**：生成战绩卡片图片，可保存到相册和分享

### 房间特性
- 支持8人以内玩家同时游戏
- 实时显示玩家积分变化
- 操作记录以聊天室形式展示
- 自动高亮"我"的操作和金额
- 积分过长时自动滚动显示

## 技术栈

- **框架**：微信小程序原生框架
- **UI组件**：WeUI + 自定义组件
- **存储**：本地存储 (wx.setStorageSync / wx.getStorageSync)
- **绘图**：Canvas 2D API (用于生成战绩图片)
- **扫码**：微信扫码API (wx.scanCode)

## 目录结构

```
miniprogram/
├── app.js              # 应用入口
├── app.json            # 应用配置
├── app.wxss            # 全局样式
├── pages/              # 页面目录
│   ├── home/           # 首页
│   │   ├── home.js     # 首页逻辑
│   ├── room/            # 房间页面
│   │   ├── room.js     # 房间逻辑
│   │   ├── room.wxml   # 房间模板
│   │   └── room.wxss   # 房间样式
│   └── record/         # 新增记账页面
│       ├── record.js    # 记账逻辑
│       ├── record.wxml  # 记账模板
│       └── record.wxss  # 记账样式
├── images/             # 图片资源
└── components/         # 自定义组件
```

## 使用说明

### 创建房间
1. 输入昵称，选择头像
2. 点击"创建房间"按钮
3. 输入房间名称，选择游戏模式
4. 点击"立即创建"进入房间

### 加入房间
1. 输入昵称，选择头像
2. 点击"加入房间"按钮
3. 使用微信扫码功能扫描房间二维码
4. 自动跳转到房间页面

### 普通模式
- 点击玩家头像可以转账积分
- 支持批量向多个玩家支出积分
- 点击"结算"按钮结束游戏

### 下注模式
- 点击"奖池"卡片可以转入积分
- 点击"收取奖池"按钮可以收取全部奖池
- 玩家之间不能直接转账，只能与奖池交互

### 游戏结算
1. 房主点击"结算"按钮
2. 确认后自动计算玩家战绩
3. 生成战绩卡片图片
4. 可保存到相册或分享给好友

## 配置说明

### project.config.json
- `appid`: 微信小程序AppID
- `projectname`: 项目名称
- `miniprogramRoot`: 小程序代码目录

### app.json
- `pages`: 页面路径列表
- `window`: 窗口样式配置
- `style`: 样式版本

## 开发说明

### 环境要求
- 微信开发者工具（建议最新版本）
- 微信小程序基础库 3.13.2+

### 运行项目
1. 克隆项目到本地
2. 使用微信开发者工具打开项目目录
3. 配置项目AppID
4. 点击编译运行

### API说明
项目主要使用以下微信小程序API：
- `wx.setStorageSync` / `wx.getStorageSync` - 本地存储
- `wx.scanCode` - 扫码功能
- `wx.chooseAvatar` - 选择头像
- `wx.navigateTo` - 页面跳转
- `wx.createSelectorQuery` - 节点查询
- `wx.canvasToTempFilePath` - Canvas转图片
- `wx.saveImageToPhotosAlbum` - 保存到相册

## 注意事项

1. **数据存储**：当前使用本地存储，数据仅在设备本地保存
2. **二维码功能**：生成的二维码为Canvas绘制的文字，非真实二维码
3. **积分安全**：所有积分操作均为本地计算，请谨慎操作
4. **结算不可逆**：游戏结算后积分重置，无法恢复

## 后续优化建议

1. 接入云开发或后端服务，实现多设备数据同步
2. 生成真实的二维码图片，替代Canvas绘制
3. 添加游戏规则配置（如初始积分、奖池规则等）
4. 支持房间密码保护
5. 添加历史房间查询功能

## 作者

Craft - 腾讯云开发专家

## 许可证

MIT License
